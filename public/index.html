<!DOCTYPE html>
<html>
  <head>
    <link rel="stylesheet" href="styles.css">
    <meta charset="utf-8">
    <script type="text/javascript" src="bundle.js"></script>
    <link href="https://fonts.googleapis.com/css?family=PT+Mono" rel="stylesheet">

    <title>
      Downhill Hazard
    </title>
  </head>
  <body>
    <div class="game-display">
        <div class="hud">
          <div class = "hud-left">
            <div class = "hud-time">
              TIME <div class="hud-time_val">00'00"00</div>
            </div>
            <div class = "hud-best-time">
              BEST 00:00:00
            </div>
          </div>
          <div class = "hud-right">
            <div class= "hud-speed">
              SPEED <div class="hud-speed_val">0</div> Km/h
            </div>
            <div class= "hud-points">
              <div class="hud-points_val">0</div> POINTS
            </div>
          </div>
        </div>
        <canvas id="glCanvas"></canvas>
        <canvas id="flat-canvas"></canvas>
    </div>
      <script id="default-vertex-shader" type="glsl">
      attribute vec4 a_pos; // input position
      uniform mat4 view_matrix; //perspective/scale matrix
      void main() {
        //output clip-space coordinate position
        gl_Position = view_matrix * a_pos;
      }
    </script>
    <script id="default-fragment-shader" type="glsl">
    //shader to calculate fragment colors from texture
      precision mediump float;
      void main() {
        gl_FragColor = vec4(1, 0, 0.5, 1); // return redish-purple
      }
    </script>

    <script id="skinned-colored-vertex-shader" type="glsl">
      attribute vec4 a_pos;
      attribute vec4 vColor;
      attribute vec2 a_bone_indices;
      attribute vec2 a_weights;

      varying vec4 v_color;
      uniform mat4 view_matrix;
      uniform mat4 boneTransforms[20];
      void main() {
        vec4 newVertex;
        int index;
        index = int(a_bone_indices.x);
        newVertex = (boneTransforms[index] * a_pos) * a_weights.x;
        index = int(a_bone_indices.y);
        newVertex = (boneTransforms[index] * a_pos) * a_weights.y + newVertex;
        gl_Position = view_matrix * vec4(newVertex.xyz, 1);
        v_color = vColor;
      }

    </script>
    <script id="colored-vertex-shader" type="glsl">
    attribute vec4 a_pos;
    attribute vec4 vColor;
    uniform mat4 view_matrix;
    varying vec4 v_color;
    void main() {
      gl_Position = view_matrix * a_pos;
      v_color = vColor;
    }
     
  </script>
  <script id="colored-fragment-shader" type="glsl">
    varying lowp vec4 v_color;
    void main() {
      gl_FragColor = v_color;
    }
  </script>

  <script id="textured-vertex-shader" type="glsl">
  attribute vec2 a_uvs;
  attribute vec4 a_pos;

  uniform mat4 view_matrix;
  varying vec2 v_uvs;
  void main() {
    gl_Position = view_matrix * a_pos;
    v_uvs = a_uvs;
  }
  </script>

  <script id="skinned-textured-vertex-shader" type="glsl">
  attribute vec2 a_uvs;
  attribute vec4 a_pos;
  attribute vec4 a_weights;
  attribute vec4 a_bone_indices;

  uniform mat4 view_matrix;
  uniform mat4 boneTransforms[20];
  varying vec2 v_uvs;
  void main() {
    vec4 vertex= vec4(0.0, 0.0, 0.0, 0.0);
    int idx;

    idx = int(a_bone_indices.x);
    vertex = (boneTransforms[idx] * a_pos) * a_weights.x;

    for(int i =0; i < 2; ++i){
        idx = int(a_bone_indices[i]);
        vertex += (boneTransforms[idx] * a_pos) * a_weights[i];
    }
    v_uvs = a_uvs;
    gl_Position = view_matrix * vec4(vertex.xyz, 1);
  }
  </script>
  <script id="textured-fragment-shader" type="glsl">
    precision mediump float;

    varying vec2 v_uvs;
    uniform sampler2D u_texture;

    void main() {
      gl_FragColor = texture2D(u_texture, v_uvs);
      if(gl_FragColor.a < 0.5)
        discard;
    }
  </script>

  </body>

</html>
